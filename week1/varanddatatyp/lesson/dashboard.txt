#!/usr/bin/env python3
"""
AI Learning Dashboard - Day 2: Variables, Data Types, and Operators
Enhanced: Interactive Teaching and Playground
"""

from flask import Flask, render_template, jsonify, request
import ast
import time
import threading
from lesson_code import SimpleAIAgent

app = Flask(__name__)
ai_agent = SimpleAIAgent("DashboardBot")
metrics_history = []


def update_metrics():
    """Continuously update simple metrics in background."""
    while True:
        status = ai_agent.get_agent_status()
        metrics_history.append({
            "timestamp": time.time(),
            "total_interactions": status["total_interactions"],
            "success_rate": status["success_rate"],
            "average_confidence": status["average_confidence"],
            "is_active": status["is_active"],
        })
        if len(metrics_history) > 50:
            metrics_history[:] = metrics_history[-50:]
        time.sleep(5)


@app.route("/")
def dashboard():
    return render_template("dashboard.html")


@app.route("/api/demo/teach", methods=["POST"])
def run_teaching_demo():
    """Show Python data types with definitions, examples, and AI context."""
    types_info = [
        {
            "data_type": "int",
            "description": "Whole numbers without decimals.",
            "example": "epochs = 100",
            "ai_use": "Used for counting training loops, batches, or samples.",
        },
        {
            "data_type": "float",
            "description": "Numbers with decimal precision.",
            "example": "learning_rate = 0.001",
            "ai_use": "Represents continuous metrics like accuracy or probabilities.",
        },
        {
            "data_type": "str",
            "description": "Sequence of characters (text).",
            "example": "prompt = 'Hello AI'",
            "ai_use": "Stores text prompts, labels, or chat messages.",
        },
        {
            "data_type": "bool",
            "description": "Logical value True or False.",
            "example": "is_ready = True",
            "ai_use": "Used for control flags and decision logic.",
        },
        {
            "data_type": "list",
            "description": "Ordered, mutable collection.",
            "example": "scores = [0.9, 0.85, 0.8]",
            "ai_use": "Stores multiple values like prediction results or records.",
        },
        {
            "data_type": "tuple",
            "description": "Ordered, immutable collection.",
            "example": "record = ('cat', 'animal')",
            "ai_use": "Holds fixed pairs of values like (input, label).",
        },
        {
            "data_type": "set",
            "description": "Unordered collection of unique elements.",
            "example": "features = {'A', 'B', 'C'}",
            "ai_use": "Represents distinct categories or unique features.",
        },
        {
            "data_type": "dict",
            "description": "Key-value mapping structure.",
            "example": "metrics = {'accuracy': 0.95}",
            "ai_use": "Stores configurations, metrics, or named parameters.",
        },
        {
            "data_type": "complex",
            "description": "Number with real and imaginary parts.",
            "example": "z = 0.8 + 0.3j",
            "ai_use": "Used in advanced signal processing or neural simulations.",
        },
        {
            "data_type": "NoneType",
            "description": "Represents the absence of a value.",
            "example": "value = None",
            "ai_use": "Used for missing data or optional parameters.",
        },
    ]
    ai_agent.process_input("Teaching Python data types for AI")
    return jsonify(
        {
            "types": types_info,
            "summary": f"{len(types_info)} Python data types explained.",
            "comment": "ðŸ’¡ Each data type is a building block for AI systems â€” used in datasets, model configs, or inference logic.",
        }
    )


@app.route("/api/playground", methods=["POST"])
def playground():
    """Evaluate user-provided expression safely and explain its type."""
    data = request.get_json()
    user_input = data.get("expression", "")

    if not user_input.strip():
        return jsonify({"error": "No input provided"}), 400

    try:
        result = ast.literal_eval(user_input)
        dtype = type(result).__name__
    except Exception:
        result = user_input
        dtype = "str (unparsed)"

    ai_examples = {
        "int": "Used for counting epochs, iterations, or samples.",
        "float": "Represents continuous values like learning rate or accuracy.",
        "str": "Stores text like prompts, labels, or messages.",
        "list": "Holds a sequence of data samples or tokens.",
        "tuple": "Immutable grouping of related values (e.g., input & label).",
        "set": "Represents unique features or categories.",
        "dict": "Used for mappings like metric_name â†’ score.",
        "bool": "Used in flags (e.g., model_ready = True).",
        "NoneType": "Represents missing or optional data.",
        "complex": "Can encode signal amplitude and phase.",
    }

    explanation = ai_examples.get(dtype, "Generic Python data type used in AI programming.")
    ai_agent.process_input(f"Playground evaluated {user_input}")
    return jsonify(
        {
            "input": user_input,
            "evaluated_value": str(result),
            "data_type": dtype,
            "ai_context": explanation,
        }
    )


if __name__ == "__main__":
    threading.Thread(target=update_metrics, daemon=True).start()
    print("ðŸš€ Starting AI Dashboard with Data Type Lesson and Playground...")
    print("ðŸ“Š Open http://localhost:5000")
    app.run(debug=True, host="0.0.0.0", port=5000)
